var forceGraph=function(t,e){this.config=e,this.data=t,this.edges=this.getEdges(),this.nodes=this.getNodes(),this.createElements(),color=d3.scale.category20();var a=this.svg.selectAll(".link").data(this.edges).enter().append("line").attr("class","link").attr("marker-end","url(#end)").style("stroke-width",1).style("stroke-dasharray",function(t){return 0===t.score?"5,5":void 0}).style("stroke",function(t){return 0===t.score?"#ff6300":"#96e6ff"}),r=this.svg.selectAll(".node").data(this.nodes).enter().append("g").attr("class","nodeGroup").on("mouseover",function(t){d3.select(this).select("text").style("visibility","visible")}).on("mouseout",function(t){d3.select(this).select("text").style("visibility","hidden")});r.append("a").attr("href",function(t){return/^NM_[0-9]{5,}/i.test(t.Name)?"/variant/"+t.Name:"/gene/"+t.Name}).append("circle").attr("class","node").attr("r",this.config.nodeRadius).style("fill",function(t){return color(t.Name)}).call(this.force.drag),r.append("text").attr("class","nodeText").attr("dx",7).attr("dy",10).style("font-size","10px").style("visibility","hidden").text(function(t){return t.Name});this.force.on("tick",function(){a.attr("x1",function(t){return t.source.x}).attr("y1",function(t){return t.source.y}).attr("x2",function(t){return t.target.x}).attr("y2",function(t){return t.target.y}),r.attr("transform",function(t){return"translate("+[t.x,t.y]+")"})})};forceGraph.prototype.getData=function(t){return t.links=t.links.filter(function(t){return 1===t.score}),t},forceGraph.prototype.getEdges=function(){var t=this.data.nodes,e=this.data.links,a=[];return e.forEach(function(e){var r=t.filter(function(t){return t.ID===e.source})[0],n=t.filter(function(t){return t.ID===e.target})[0];a.push({source:r,target:n,score:e.score})}),a},forceGraph.prototype.getNodes=function(){return this.data.nodes},forceGraph.prototype.createElements=function(){var t=this.config.width||1e3;height=this.config.height||800;d3.scale.category20();this.svg=d3.select(this.config.targetDOM).append("svg").attr("width",t).attr("height",height),this.force=d3.layout.force().size([t,height]).nodes(this.nodes).links(this.edges).linkStrength(.1).friction(.9).linkDistance(function(t){return 1===t.score?150:250}).charge(-150).charge(-30).gravity(.1).theta(.8).alpha(.1).start(),this.svg.append("svg:defs").selectAll("marker").data(["end"]).enter().append("svg:marker").attr("id",String).attr("viewBox","0 -5 10 10").attr("refX",20).attr("refY",0).attr("markerWidth",6).attr("markerHeight",6).attr("orient","auto").append("svg:path").attr("d","M0,-5L10,0L0,5")};var proteinDomainGraph=function(t,e){this.config=e,this.data=t,this.mutation=this.getMutationData(),this.createSVG(),this.x=d3.scale.linear().domain([0,this.data.length]).range([0,this.config.width-3*this.config.xoffset]),this.markMutations(),this.drawRegions()};proteinDomainGraph.prototype.createSVG=function(){var t=this.config.width||1e3;height=this.config.height||200,this.svg=d3.select(this.config.targetDOM).append("svg").attr("width",t).attr("height",height),this.svg.append("g").attr("transform","translate(-10,0)").attr("class","pdgraph")},proteinDomainGraph.prototype.getMutationData=function(){return config=this.config,this.data.mutation.forEach(function(t){t.ranHeight=Math.random()*config.yoffset*.5+.1*config.yoffset}),this.data.mutation},proteinDomainGraph.prototype.markMutations=function(){var t=this.x,e=d3.scale.category20c(),a=this.config,r=(d3.select(".pdgraph").selectAll().data(this.mutation).enter().append("line").attr("y1",function(t){return t.ranHeight}).attr("y2",a.yoffset).attr("x1",function(e){return t(a.xoffset+parseInt(e.name.replace(/[^0-9\.]/g,"")))}).attr("x2",function(e){return t(a.xoffset+parseInt(e.name.replace(/[^0-9\.]/g,"")))}).attr("class","needle-line").attr("stroke","lightgrey").attr("stroke-width",1.5),d3.select(".pdgraph").selectAll().data(this.mutation).enter().append("a").attr("href",function(t){return"#"+t.name}));r.append("circle").attr("cy",function(t){return t.ranHeight+a.headRadius}).attr("cx",function(e){return t(a.xoffset+parseInt(e.name.replace(/[^0-9\.]/g,"")))}).attr("r",a.headRadius).attr("class","needle-head").style("fill",function(t){return e(t.name)});d3.select(".pdgraph").selectAll().data(this.mutation).enter().append("text").attr("class","needleText").attr("text-anchor","center").attr("fill","black").attr("opacity",.5).attr("x",function(e){return t(a.xoffset+parseInt(e.name.replace(/[^0-9\.]/g,""))+2)}).attr("y",function(t){return t.ranHeight}).attr("dx","3px").attr("font-size",a.headFontSize).text(function(t){return t.name})},proteinDomainGraph.prototype.drawRegions=function(){var t=this.x,e=d3.scale.category20(),a=this.config.xoffset,r=(d3.select(".pdgraph").selectAll().data(["dummy"]).enter().insert("g",":first-child").attr("class","regionsBG").append("rect").attr("ry","3").attr("rx","3").attr("x",t(a)).attr("y",this.config.yoffset).attr("width",t(this.data.length)).attr("height",this.config.regionBGHeight).attr("fill","lightgrey"),d3.select(".pdgraph").selectAll().data(this.data.region).enter().append("g").attr("class","regionGroup"));r.append("a").attr("href",function(t){return"http://pfam.xfam.org/family/"+t.name}).append("rect").attr("class","region").attr("x",function(e){return t(e.start+a)}).attr("y",this.config.yoffset-(this.config.regionHeight-this.config.regionBGHeight)/2).attr("ry","3").attr("rx","3").attr("width",function(e){return t(e.end)-t(e.start)}).attr("height",this.config.regionHeight).style("fill",function(t){return e(t.start)});r.append("text").attr("class","regionText").attr("text-anchor","center").attr("fill","black").attr("opacity",.5).attr("x",function(e){return t(e.start+a)}).attr("y",this.config.yoffset+2*this.config.regionHeight).attr("dx","2px").style("font-size",this.config.regionFontSize).style("text-decoration","bold").text(function(t){return t.name})},$(document).ready(function(){var t=new Bloodhound({datumTokenizer:Bloodhound.tokenizers.whitespace,queryTokenizer:Bloodhound.tokenizers.whitespace,prefetch:"../data/Gene.HUGO_GENE_SYMBOL.json"}),e=new Bloodhound({datumTokenizer:Bloodhound.tokenizers.whitespace,queryTokenizer:Bloodhound.tokenizers.whitespace,prefetch:"../data/Variant.MUT_HGVS_NT_ID.json"});$("input.typeahead").typeahead({highlight:!0},{name:"genes",source:t,templates:{header:'<h3 class="searchbar-header-genes">Genes</h3>'}},{name:"variants",source:e,templates:{header:'<h3 class="searchbar-header-variants">Variants</h3>'}})}),$(document).ready(function(){$("input.typeahead").bind("typeahead:select",function(t,e){/^NM_[0-9]{5,}/i.test(e)?window.location.href="/variant/"+e:window.location.href="/gene/"+e})}),$(document).ready(function(){$("form#advanceSearch").submit(function(t){t.preventDefault(),$.ajax({url:"/search",type:"POST",data:$("#advanceSearch").serialize(),success:function(t){console.log(t),$("#searchResult").html(t)}})});var t=new Bloodhound({datumTokenizer:Bloodhound.tokenizers.whitespace,queryTokenizer:Bloodhound.tokenizers.whitespace,prefetch:"../data/Gene.CHROMOSOME_NAME.json"}),e=new Bloodhound({datumTokenizer:Bloodhound.tokenizers.whitespace,queryTokenizer:Bloodhound.tokenizers.whitespace,prefetch:"../data/VariantProperty.IN_PFAM.json"}),a=new Bloodhound({datumTokenizer:Bloodhound.tokenizers.whitespace,queryTokenizer:Bloodhound.tokenizers.whitespace,prefetch:"../data/VariantProperty.IN_MOTIF.json"}),r=new Bloodhound({datumTokenizer:Bloodhound.tokenizers.whitespace,queryTokenizer:Bloodhound.tokenizers.whitespace,prefetch:"../data/VariantProperty.CLINVAR_CLINICAL_SIGNIFICANCE.json"});$("input.chrName-typeahead").typeahead({highlight:!0},{name:"chromosomeLocation",source:t}),$("input.inPfam-typeahead").typeahead({highlight:!0},{name:"inPfam",source:e}),$("input.inMotif-typeahead").typeahead({highlight:!0},{name:"inMotif",source:a}),$("input.clinVarSig-typeahead").typeahead({highlight:!0},{name:"clinVarSig",source:r})}),$(document).ready(function(){$("body").scrollspy({target:"#target_nav",offset:50})});